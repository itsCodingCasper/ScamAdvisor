{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <!-- Page Header -->
    <div class="text-center mb-12">
        <div class="inline-flex items-center justify-center w-16 h-16 bg-blue-100 rounded-full mb-6">
            <span class="material-icons text-blue-600 text-3xl">scanner</span>
        </div>
        <h1 class="text-4xl font-bold text-gray-900 mb-4">Content Scanner</h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
            Analyze investment content for fraud indicators using advanced AI pattern recognition.
            Our system detects suspicious language, unrealistic promises, and manipulation tactics.
        </p>
    </div>

    <!-- Scan Form -->
    <div class="google-card mb-8">
        <form id="scanForm" class="space-y-6">
            <div>
                <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                    Content to Analyze
                </label>
                <textarea id="content" name="content" rows="8"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                    placeholder="Paste investment content, social media posts, advisor messages, or website text here..."
                    required></textarea>
                <p class="text-sm text-gray-500 mt-2">
                    Tip: Include full context for better analysis. Our AI examines language patterns, promises, and
                    credibility indicators.
                </p>
            </div>

            <div>
                <label for="contentType" class="block text-sm font-medium text-gray-700 mb-2">
                    Content Type
                </label>
                <select id="contentType" name="contentType"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                    <option value="text">Text Content</option>
                    <option value="social_media">Social Media Post</option>
                    <option value="email">Email/Message</option>
                    <option value="website">Website Content</option>
                    <option value="advertisement">Advertisement</option>
                    <option value="document">Document</option>
                </select>
            </div>

            <div class="flex gap-4">
                <button type="submit" class="google-button flex-1 flex items-center justify-center py-3"
                    id="scanButton">
                    <span class="material-icons mr-2">search</span>
                    Analyze Content
                </button>
                <button type="button" class="google-button-outline px-6 py-3" onclick="clearForm()">
                    Clear
                </button>
            </div>
        </form>
    </div>

    <!-- Sample Content Examples -->
    <div class="google-card mb-8">
        <h3 class="text-lg font-semibold text-gray-900 mb-4">
            Try Sample Content
        </h3>
        <p class="text-gray-600 mb-4">
            Click on any sample below to test the fraud detection system:
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div class="border border-red-200 rounded-lg p-4 cursor-pointer hover:bg-red-50 transition-colors"
                onclick="loadSample('high-risk')">
                <div class="flex items-center mb-2">
                    <span class="material-icons text-red-500 text-sm mr-2">error</span>
                    <span class="font-medium text-red-700">High Risk Sample</span>
                </div>
                <p class="text-sm text-gray-600">
                    "üî• GUARANTEED 800% returns in 45 days! Join our EXCLUSIVE trading group with SECRET ALGORITHMS..."
                </p>
            </div>

            <div class="border border-yellow-200 rounded-lg p-4 cursor-pointer hover:bg-yellow-50 transition-colors"
                onclick="loadSample('medium-risk')">
                <div class="flex items-center mb-2">
                    <span class="material-icons text-yellow-500 text-sm mr-2">warning</span>
                    <span class="font-medium text-yellow-700">Medium Risk Sample</span>
                </div>
                <p class="text-sm text-gray-600">
                    "Limited time opportunity! Contact our certified advisor for exclusive investment tips..."
                </p>
            </div>

            <div class="border border-green-200 rounded-lg p-4 cursor-pointer hover:bg-green-50 transition-colors"
                onclick="loadSample('low-risk')">
                <div class="flex items-center mb-2">
                    <span class="material-icons text-green-500 text-sm mr-2">check_circle</span>
                    <span class="font-medium text-green-700">Low Risk Sample</span>
                </div>
                <p class="text-sm text-gray-600">
                    "Consider diversified mutual funds for long-term wealth creation. Past performance doesn't guarantee
                    future results..."
                </p>
            </div>

            <div class="border border-red-200 rounded-lg p-4 cursor-pointer hover:bg-red-50 transition-colors"
                onclick="loadSample('social-media')">
                <div class="flex items-center mb-2">
                    <span class="material-icons text-red-500 text-sm mr-2">group</span>
                    <span class="font-medium text-red-700">Social Media Fraud</span>
                </div>
                <p class="text-sm text-gray-600">
                    "üöÄ URGENT: Buy XYZ Corp before announcement tomorrow! Insider information confirms 500% jump!"
                </p>
            </div>
        </div>
    </div>

    <!-- Loading State -->
    <div id="loadingState" class="hidden google-card text-center py-8">
        <div class="inline-flex items-center">
            <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600 mr-3"></div>
            <span class="text-gray-700">Analyzing content with AI...</span>
        </div>
    </div>

    <!-- Results Section -->
    <div id="resultsSection" class="hidden">
        <div class="google-card">
            <div class="flex items-center mb-6">
                <span class="material-icons text-blue-600 text-2xl mr-3">assessment</span>
                <h2 class="text-2xl font-bold text-gray-900">Fraud Risk Analysis</h2>
            </div>

            <!-- Risk Score Display -->
            <div id="riskScoreCard" class="mb-8">
                <!-- Content will be populated by JavaScript -->
            </div>

            <!-- Detected Patterns -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Detected Fraud Patterns</h3>
                <div id="patternsContainer" class="space-y-2">
                    <!-- Patterns will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recommendations -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold text-gray-900 mb-4">Recommendations</h3>
                <div id="recommendationsContainer" class="space-y-2">
                    <!-- Recommendations will be populated by JavaScript -->
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-4 pt-6 border-t border-gray-200">
                <button class="google-button" onclick="saveReport()">
                    <span class="material-icons mr-2">save</span>
                    Save Report
                </button>
                <button class="google-button-outline" onclick="shareReport()">
                    <span class="material-icons mr-2">share</span>
                    Share Results
                </button>
                <button class="google-button-outline" onclick="reportFraud()">
                    <span class="material-icons mr-2">report_problem</span>
                    Report to Authorities
                </button>
            </div>
        </div>
    </div>
</div>

<script>
    const samples = {
        'high-risk': {
            content: `üî• GUARANTEED 800% returns in 45 days! üî•
Join our EXCLUSIVE trading group with SECRET ALGORITHMS used by billionaires!
‚úÖ Risk-FREE investment ‚úÖ No experience needed
üìû Contact certified advisor: Rajesh Sharma (SEBI Reg: IA/2024/FAKE999)
üíé Limited slots available - ACT NOW or MISS OUT FOREVER!
üéØ Our proprietary AI system has NEVER failed
üí∞ Members made ‚Çπ50 lakhs last week alone
üîê 100% confidential WhatsApp group
‚ö° Only 24 hours left to join!`,
            type: 'advertisement'
        },
        'medium-risk': {
            content: `Limited time investment opportunity available!
Contact our certified advisor for exclusive tips that could significantly boost your portfolio.
We have helped many clients achieve substantial returns.
Call now to discuss your financial goals.
Registration: IA/2024/CHECK123`,
            type: 'email'
        },
        'low-risk': {
            content: `Consider diversified mutual funds for long-term wealth creation. Systematic Investment Plans (SIPs) help average out market volatility over time. Past performance doesn't guarantee future results. Please read the offer document carefully before investing. Mutual fund investments are subject to market risks.`,
            type: 'text'
        },
        'social-media': {
            content: `üöÄ URGENT: Buy XYZ Corp before announcement tomorrow! 
Insider information confirms 500% jump! 
Trust me, I made ‚Çπ50 lakhs last week! 
Delete after reading!
WhatsApp: +91-9999999999`,
            type: 'social_media'
        }
    };

    function loadSample(sampleType) {
        const sample = samples[sampleType];
        if (sample) {
            document.getElementById('content').value = sample.content;
            document.getElementById('contentType').value = sample.type;
        }
    }

    function clearForm() {
        document.getElementById('scanForm').reset();
        document.getElementById('resultsSection').classList.add('hidden');
    }

    document.getElementById('scanForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const content = document.getElementById('content').value;
        const contentType = document.getElementById('contentType').value;

        // Show loading state
        document.getElementById('loadingState').classList.remove('hidden');
        document.getElementById('resultsSection').classList.add('hidden');
        document.getElementById('scanButton').disabled = true;

        try {
            const response = await fetch('/api/scan-content', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    content: content,
                    content_type: contentType
                })
            });

            if (!response.ok) {
                throw new Error('Analysis failed');
            }

            const result = await response.json();
            displayResults(result);

        } catch (error) {
            console.error('Error:', error);
            alert('Analysis failed. Please try again.');
        } finally {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('scanButton').disabled = false;
        }
    });

    function displayResults(result) {
        // Risk Score Card
        const riskScoreCard = document.getElementById('riskScoreCard');
        const riskClass = result.risk_level === 'High' ? 'risk-high' :
            result.risk_level === 'Medium' ? 'risk-medium' : 'risk-low';

        riskScoreCard.innerHTML = `
            <div class="p-6 rounded-lg ${riskClass}">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-2xl font-bold">Risk Level: ${result.risk_level}</h3>
                        <p class="text-lg">Score: ${result.risk_score}/100</p>
                    </div>
                    <div class="text-4xl font-bold">${result.risk_score}</div>
                </div>
            </div>
        `;

        // Detected Patterns
        const patternsContainer = document.getElementById('patternsContainer');
        if (result.detected_patterns.length > 0) {
            patternsContainer.innerHTML = result.detected_patterns.map(pattern => `
                <div class="flex items-center p-3 bg-red-50 border border-red-200 rounded-lg">
                    <span class="material-icons text-red-500 mr-3">flag</span>
                    <span class="text-red-700 font-medium">"${pattern}"</span>
                </div>
            `).join('');
        } else {
            patternsContainer.innerHTML = `
                <div class="flex items-center p-3 bg-green-50 border border-green-200 rounded-lg">
                    <span class="material-icons text-green-500 mr-3">check_circle</span>
                    <span class="text-green-700">No suspicious patterns detected</span>
                </div>
            `;
        }

        // Recommendations
        const recommendationsContainer = document.getElementById('recommendationsContainer');
        recommendationsContainer.innerHTML = result.recommendations.map(rec => `
            <div class="flex items-start p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <span class="material-icons text-blue-500 mr-3 mt-0.5">lightbulb</span>
                <span class="text-blue-700">${rec}</span>
            </div>
        `).join('');

        // Show results
        document.getElementById('resultsSection').classList.remove('hidden');

        // Scroll to results
        document.getElementById('resultsSection').scrollIntoView({
            behavior: 'smooth'
        });
    }

    function saveReport() {
        alert('Report save functionality - Implementation in progress');
    }

    function shareReport() {
        alert('Report sharing functionality - Implementation in progress');
    }

    function reportFraud() {
        alert('Report to authorities functionality - Implementation in progress');
    }
</script>
{% endblock %}